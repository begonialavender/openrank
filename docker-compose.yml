services:
  maxkb:
    image: registry.fit2cloud.com/maxkb/maxkb:latest # 使用MaxKB V2镜像
    container_name: maxkb
    restart: always # 总是重启，保证服务可靠性
    ports:
      - "8080:8080" # 将本地8080端口映射到容器的8080端口
    volumes:
      # 映射主数据目录，这通常包含上传的文件、配置等
      - ./maxkappb/maxkb_data:/opt/maxkb
      # 设置容器时区为亚洲上海，使日志和时间戳与本地一致
    environment:
      - TZ=Asia/Shanghai
      # 可以在此添加其他环境变量，例如指定内部端口（一般不需要改动）

    # 健康检查，确保服务完全启动后再进行后续操作
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/api/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    # 设置资源限制，根据你的电脑配置调整
    deploy:
      resources:
        limits:
          memory: 4G
        reservations:
          memory: 2G
